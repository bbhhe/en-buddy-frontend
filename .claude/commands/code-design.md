---
allowed-tools: Read, Glob, Grep, Task(Explore), Task(Plan)
argument-hint: <target_files_or_description>
description: 分析现有代码结构，设计详细的代码修改方案（仅读取权限，无编辑功能）
---

# 代码修改方案设计

为以下目标设计修改方案：**$ARGUMENTS**

## 🎯 命令目标

此命令用于在编写代码前进行深度分析，提供：
- 现有代码结构分析
- 具体的修改方案设计
- 风险评估和依赖关系
- 实施步骤建议

## 🔍 分析流程

### 第一阶段：代码现状调研

#### 1. 项目结构分析
- 目标：了解项目整体架构和目录结构
- 方法：使用 Glob 和 Task(Explore) 工具扫描项目
- 输出：项目架构图和关键文件清单

#### 2. 目标代码分析
- 目标：深入理解需要修改的代码模块
- 方法：使用 Read 和 Grep 工具分析目标文件
- 输出：代码结构、依赖关系、设计模式识别

#### 3. 上下文关联分析
- 目标：分析目标代码与系统其他部分的关联
- 方法：搜索相关引用、接口调用、数据流向
- 输出：影响范围评估和依赖图谱

### 第二阶段：修改方案设计

#### 1. 需求分解
- 明确具体的修改需求
- 识别功能性和非功能性需求
- 确定优先级和约束条件

#### 2. 方案设计
- 设计详细的代码结构修改方案
- 制定接口变更策略
- 规划数据迁移方案（如需要）

#### 3. 风险评估
- 识别潜在的技术风险
- 评估向后兼容性
- 制定风险缓解策略

### 第三阶段：实施规划

#### 1. 步骤分解
- 将修改方案分解为具体步骤
- 确定步骤间的依赖关系
- 估算每个步骤的工作量

#### 2. 测试策略
- 设计单元测试覆盖方案
- 规划集成测试策略
- 制定回归测试计划

## 📊 分析维度

### 代码质量维度
- **可读性**：代码复杂度、命名规范、注释完整性
- **可维护性**：模块耦合度、代码重复度、架构合理性
- **可扩展性**：设计模式使用、接口抽象程度
- **性能**：算法复杂度、资源使用效率

### 业务逻辑维度
- **功能完整性**：业务规则覆盖度
- **数据一致性**：数据处理逻辑正确性
- **异常处理**：错误场景覆盖度
- **安全性**：权限控制、数据验证

### 技术债务维度
- **过时依赖**：第三方库版本、框架兼容性
- **代码异味**：重复代码、过长方法、过大类
- **架构问题**：循环依赖、紧耦合
- **测试覆盖**：单元测试覆盖率、测试质量

## 🎨 输出格式

### 1. 概述部分
```markdown
## 📋 修改方案概述

### 目标描述
[简洁描述要实现的修改目标]

### 影响范围
- 主要影响文件：[列出关键文件]
- 影响模块：[列出相关模块]
- 预估工作量：[时间估算]

### 关键约束
- [技术约束]
- [业务约束]
- [兼容性要求]
```

### 2. 现状分析
```markdown
## 🔍 现状分析

### 当前架构
[架构图或文字描述]

### 代码结构
[当前代码的组织结构]

### 存在问题
[列出发现的问题和改进点]

### 依赖关系
[代码模块间的依赖关系]
```

### 3. 详细方案
```markdown
## 🛠️ 详细修改方案

### 修改策略
[总体修改策略说明]

### 具体修改项
#### 3.1 文件：[文件路径]
**修改类型**：[新增/修改/删除]
**修改内容**：
- [具体修改点1]
- [具体修改点2]

**风险评估**：[高/中/低]
**影响范围**：[受影响的功能]

#### 3.2 接口变更
**接口名称**：[接口名称]
**变更类型**：[新增参数/修改返回值/删除接口]
**兼容性**：[向后兼容/破坏性变更]

### 数据结构变更（如需要）
[数据库表结构、DTO、实体类变更]
```

### 4. 实施计划
```markdown
## 📅 实施计划

### 优先级排序
1. **高优先级**：[关键修改项]
2. **中优先级**：[重要修改项]
3. **低优先级**：[优化修改项]

### 实施步骤
#### 步骤1：[步骤名称]
- **工作内容**：[具体要做的事情]
- **前置条件**：[需要的前提条件]
- **验证标准**：[如何验证完成]
- **预估时间**：[时间估算]

### 测试策略
- **单元测试**：[需要编写的测试]
- **集成测试**：[需要验证的场景]
- **回归测试**：[需要回归的功能]
```

### 5. 风险控制
```markdown
## ⚠️ 风险控制

### 技术风险
| 风险项 | 概率 | 影响 | 缓解措施 |
|--------|------|------|----------|
| [风险描述] | [高/中/低] | [高/中/低] | [具体措施] |

### 业务风险
[可能影响业务连续性的风险及应对方案]

### 回滚方案
[如果出现问题如何回滚]
```

## 🚀 使用示例

```bash
# 分析特定文件的修改方案
/code-design "为UserService添加邮箱验证功能"

# 分析模块重构方案
/code-design "重构订单处理模块，提高可扩展性"

# 分析性能优化方案
/code-design "优化图片上传接口的并发处理能力"
```

## 💡 最佳实践

### 分析原则
1. **全面性**：从多个维度分析代码，避免遗漏重要方面
2. **深入性**：不仅看表面，要深入理解代码逻辑和设计意图
3. **前瞻性**：考虑未来可能的扩展需求
4. **可行性**：提出的方案应该切实可行

### 输出原则
1. **具体化**：避免模糊描述，提供具体的修改建议
2. **可操作**：每个建议都应该能够直接执行
3. **优先级**：明确指出哪些是必须做的，哪些是可选的
4. **风险意识**：始终考虑修改可能带来的副作用

### 质量标准
- [ ] 分析覆盖所有相关代码文件
- [ ] 修改方案具有可操作性
- [ ] 风险评估全面且准确
- [ ] 实施步骤逻辑清晰
- [ ] 输出格式规范统一

## 🔧 工具使用限制

**重要**：此命令严格限制为只读操作，禁止使用任何修改工具：
- ✅ 允许：Read, Glob, Grep, Task(Explore), Task(Plan)
- ❌ 禁止：Edit, Write, Bash, NotebookEdit

任何尝试修改代码的操作都将被拒绝。此命令的目的是提供分析和建议，而非直接实施修改。

## 📝 注意事项

1. **权限约束**：此命令仅用于分析，不能修改任何文件
2. **信息准确性**：基于当前代码状态进行分析，如果代码有变化需要重新分析
3. **建议性质**：所有输出都是建议性质，具体实施需要结合实际情况
4. **团队协作**：建议在团队内讨论方案后再实施